<!doctype html><html lang=fr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Param√©trage PROMTAIl en tant que service Windows</title><style>html body{font-family:raleway,sans-serif;background-color:#656565}:root{--accent: #cc9933;--border-width:  5px }</style><link rel=stylesheet href=https://vincent-gou.github.io/css/main.css><link rel=stylesheet href=https://vincent-gou.github.io/css/adoc.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css integrity=sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u crossorigin=anonymous><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/kotlin.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/scala.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/swift.min.js></script><script>hljs.initHighlightingOnLoad();</script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js></script><script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script><script>$(document).on('click',function(){$('.collapse').collapse('hide');})</script><meta name=generator content="Hugo 0.78.2"></head><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><body><a class=flagselect href=/post/promtail_windows_service/>früá´üá∑</a><nav class="navbar navbar-default navbar-fixed-top"><div class=container><div class=navbar-header><a class="navbar-brand visible-xs" href=#>Param√©trage PROMTAIl en tant que service Windows</a>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href=/>Accueil</a></li><li><a href=/project/>Projets</a></li><li><a href=/post/>Articles</a></li><li><a href=/tags/>Tags</a></li><li><a href=/calendar/>Calendrier</a></li></ul><ul class="nav navbar-nav navbar-right"><li class=navbar-icon><a href=mailto:contact@vincent-gou.fr><i class="fa fa-envelope-o"></i></a></li><li class=navbar-icon><a href=https://github.com/vincent-gou/><i class="fa fa-github"></i></a></li><li class=navbar-icon><a href=https://www.linkedin.com/in/vincent-gou/><i class="fa fa-linkedin"></i></a></li><li class=navbar-icon><a href=https://www.malt.fr/profile/vincentgourrierec/><i class="fa fa-certificate"></i></a></li></ul></div></div></nav><h4 class=page_info>Informations sur la page:</h4><h6 class=page_info>Cet article contient 267 mots.</br>Comptez 2 minutes de temps de lecture</h6><main><div class=item><h4><a href=/post/promtail_windows_service/>Param√©trage PROMTAIl en tant que service Windows</a></h4><h5>July 2, 2020</h5><a href=https://vincent-gou.github.io/tags/grafana><kbd class=item-tag>grafana</kbd></a>
<a href=https://vincent-gou.github.io/tags/promtail><kbd class=item-tag>promtail</kbd></a>
<a href=https://vincent-gou.github.io/tags/loki><kbd class=item-tag>loki</kbd></a></div><br><div class=text-justify><div class=sect1><h2 id=_objectifs>Objectifs</h2><div class=sectionbody><div class=ulist><ul><li><p>Permettre le d√©marrage du processus promtail avec Windows</p></li></ul></div></div></div><div class=sect1><h2 id=_pr√©_requis>Pr√©-requis</h2><div class=sectionbody><div class=ulist><ul><li><p>NSSM, t√©l√©chargeable ici: <a href=https://nssm.cc/release/nssm-2.24.zip class=bare>https://nssm.cc/release/nssm-2.24.zip</a></p></li><li><p>promtail pour Windows, t√©l√©chargeable ici: <a href=https://github.com/grafana/loki/releases class=bare>https://github.com/grafana/loki/releases</a></p></li><li><p>Configuration promtail fonctionnelle (fichier de config yml)</p></li></ul></div></div></div><div class=sect1><h2 id=_pr√©paration>Pr√©paration</h2><div class=sectionbody><div class=ulist><ul><li><p>D√©compressez les sources NSSM et placez les dans le r√©pertoire ou se trouve promtail</p></li></ul></div><div class="admonitionblock note"><table><tbody><tr><td class=icon><div class=title>Note</div></td><td class=content>Pour les besoins de cet exemple, l‚Äôemplacement commun √† promtail et nssm sera "c:\Program Files\telegraf\"</td></tr></tbody></table></div></div></div><div class=sect1><h2 id=_cr√©ation_du_service_promtail>Cr√©ation du service promtail</h2><div class=sectionbody><div class=paragraph><p>Lancez une commande Windows, puis tapez les commandes suivantes:</p></div><div class=listingblock><div class=content><pre class=highlight><code class=language-bash data-lang=bash>c:\users\vgourrierec&gt;&#34;C:\Program Files\telegraf\nssm.exe&#34; install promtail_agent &#34;c:\Program Files\telegraf\promtail.exe&#34; <b class=conum>(1)</b>
Le service &#34;promtail_agent&#34; a √©t√© install√© avec succ√®s!

c:\users\vgourrierec&gt;&#34;C:\Program Files\telegraf\nssm.exe&#34; set promtail_agent DisplayName &#34;Promtail Agent&#34; <b class=conum>(2)</b>
Configuration de la valeur du param√®tre &#34;DisplayName&#34; du service &#34;promtail_agent&#34;.

c:\users\vgourrierec&gt;&#34;C:\Program Files\telegraf\nssm.exe&#34; set promtail_agent Description &#34;Log centralization with Promtail Agent&#34; <b class=conum>(3)</b>
Configuration de la valeur du param√®tre &#34;Description&#34; du service &#34;promtail_agent&#34;.

c:\users\vgourrierec&gt;&#34;C:\Program Files\telegraf\nssm.exe&#34; set promtail_agentAppParameters &#34;-config.file config_promtail.yml&#34; <b class=conum>(4)</b>
Configuration de la valeur du param√®tre &#34;AppParameters&#34; du service &#34;promtail_agent&#34;

c:\users\vgourrierec&gt;&#34;C:\Program Files\telegraf\nssm.exe&#34; set promtail_agent AppStdout &#34;c:\Program Files\telegraf\promtail.log&#34; <b class=conum>(5)</b>
Configuration de la valeur du param√®tre &#34;AppStdout&#34; du service &#34;promtail_agent&#34;.

c:\users\vgourrierec&gt;&#34;C:\Program Files\telegraf\nssm.exe&#34; set promtail_agent AppStderr &#34;c:\Program Files\telegraf\promtail.log&#34; <b class=conum>(6)</b>
Configuration de la valeur du param√®tre &#34;AppStderr&#34; du service &#34;promtail_agent&#34;.</code></pre></div></div><div class="colist arabic"><ol><li><p>Cr√©ation du service avec les options par d√©faut. Le service n‚Äôest pas d√©marr√© lors de la cr√©ation.</p></li><li><p>Configuration du nom affich√© dans services.msc</p></li><li><p>Configuration de la description affich√©e dans services.msc</p></li><li><p>Configuration du param√®tre de lancement du process promtail vers le fichier de config plac√© dans le m√™me r√©pertoire que l‚Äôex√©cutable promtail.exe.</p></li><li><p>Ajout de la redirection vers le fichier de log</p></li><li><p>Ajout de la redirection vers le fichier de log</p></li></ol></div></div></div><div class=sect1><h2 id=_compl√©ments>Compl√©ments</h2><div class=sectionbody><div class=paragraph><p>Le service promtail est maintenant pilotable via le gestionnaire de services Windows.</p></div><div class=paragraph><p>Par d√©faut le service d√©marrera en automatique.</p></div></div></div></div><h4 class=page-header>Auteur:</h4><figure><img class=avatar src=../../../images/vincent.fr.png alt><figcaption><a href=https://vincent-gou.github.io/authors/vincent-gourrierec/>Vincent Gourrierec</a></figcaption></figure></main><footer><p class="copyright text-muted">2020 - ¬© All rights reserved. Powered by <a href=https://gohugo.io>Hugo</a> and <a href=https://github.com/calintat/minimal>Minimal</a> theme and [Vincent Gourrierec] (<a href=https://vincent-gou.fr>https://vincent-gou.fr</a>)</p></footer></body></html>